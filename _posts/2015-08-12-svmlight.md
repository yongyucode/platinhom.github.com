---
layout: post_jq
title: SVMlight
date: 2015-08-11 17:15:35
categories: MathStat
tags: Statistics MachineLearning
---





## SVMlight Multiclass

### 数据预处理

Traing数据SVMlight multiclass的输入格式: 

~~~
<line> .=. <target> <feature>:<value> <feature>:<value> ... <feature>:<value> # <info>
<target> .=. <integer>
<feature> .=. <integer>
<value> .=. <float>
<info> .=. <string>

3 1:0.43 3:0.12 9284:0.2 # abcdef
~~~

第一行可以是注释,使用`#`在开头. 其余每行都是数据.  
target是类的值(需要大于0),feature/value对是对应每个feature的值,feature是某个数值来代替和区分.  

#### Excel预处理

Excel主要用来做数据最初步的放置, 整理好后全部复制再黏贴到文本文档成为一份data即可.随后就可以进行后续处理或者直接SVM了.

- 对齐数据: 例如根据某些ID, 将类ID和feature对上.  
`=INDEX(Sheet2!C$2:C$636,MATCH($B6,Sheet2!$I$2:$I$636,0))`
使用id进行match. match函数用来查找区域并返回查到到的值在第几项, 从而用该项获取刚行别的值(用index函数).  
这里, 当前表格储存了feature和对应的每行数据的ID(*$B6*). sheet2里有ID(*sheet2!I*)及对应的类号(*sheet2!C*). 在当前表格的新列中使用该公式,将自动获取对应类号.

- 构建数据列: 在新的数据列,复制原数据值并构建成SVM所需 **feature:value** 形式. 
使用column函数计算所在列号: `=COLUMN()-89&":"&AQ2`  
其中,AQ2是值所在, COLUMN()-89是扣出feature编号.`&`连接字符串.89这里根据自己数据表格进行修改了,保证第一个feature是1就好了.  

- 构建不同的trainingset 和validationset: 新建一列,并全部赋值为`=rand()`, 然后根据双列(1.分类号, 2.随机数大小)来排序即可. 按比例抽取数值.   
这个过程最好借助VBA来实现, 在每次使用一次rand()函数和排序后,执行一次VBA脚本, 然后将数据复制到一个training和validation的sheet里, 再复制出来.  
使用VBA来进行优点是一套都在excel中进行,但缺点是麻烦..尤其要自己分好每类的数量..

下面的是个示例VBA处理数据.这里有点问题,因为SVM的*1:10* 的格式拿过去时会被作为时间格式进行处理...有待解决...

~~~
Sub CopyValue()

Sheet10.Range("A1:A999").Text = Sheet2.Range("C2:C1000").Value
Sheet10.Range("B1:CU999").Text = Sheet2.Range("CZ2:GS1000").Value

'class 1: 1-8 , 8
Sheet3.Range("A1:A6").Value = Sheet10.Range("A1:A6").Value
Sheet4.Range("A7:A8").Value = Sheet10.Range("A7:A8").Value

'class 2: 9-26 , 18
Sheet3.Range("A9:A22").Value = Sheet10.Range("A9:A22").Value
Sheet4.Range("A23:A26").Value = Sheet10.Range("A23:A26").Value

'class 3: 27-36 , 10
Sheet3.Range("A27:A34").Value = Sheet10.Range("A27:A34").Value
Sheet4.Range("A34:A36").Value = Sheet10.Range("A34:A36").Value

' Delete blank row
Sheet3.Range("a1:a" & Range("a65536").End(xlUp).Row).SpecialCells(xlCellTypeBlanks).EntireRow.Delete
Sheet4.Range("a1:a" & Range("a65536").End(xlUp).Row).SpecialCells(xlCellTypeBlanks).EntireRow.Delete

End Sub
~~~


#### Python预处理

准备好数据后, 需要区分出一份training set和一份validation set, 这里使用下面的python脚本处理. 可以产生多套不同排序而产生的training set和validation set, 默认比例是近似4:1.

Python script to generate training sets and validation sets. User can assign the total output set number for many model and also the training set radio.  
Use as: `python SVM_trainvalid.py data.txt 20 0.8`

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<pre><code class="language-python" id="src"></code></pre>

<script>
$.get("/other/scripts/SVM_trainvalid.py",function(data,status){
	$("#src").html(data);
	Prism.highlightAll();
});
</script>

#### Matlab预处理

类似于python预处理,其实不过是换了不同函数和操作方式罢了.类似还可以用R进行预处理和分析.  
利用randperm产生随机数列,这里50假设有50个数据.  
根据随机数列的百分比数量的序号来选取数据.

Matlab做法: 

~~~ matlab
A=load('data.txt');
B=randperm(50); 
Validation=A(B(1:10),:);
Training=A(B(11:50),:);
~~~

## SVMlight Multiclass学习过程(learn)

`svm_multiclass_learn -c 1.0 example_file model_file`

## SVMlight Multiclass分类过程(classfy)

`svm_multiclass_classify [options] test_example_file model_file output_file`

~~~ bash
#! /bin/bash
# Author: Hom 2015.8.18
# Use "python SVM_trainvalid.py data_file modelnum trainradio" to generate training and validation sets first.

if [ -z $1 ];then
	echo "No input data file is given!"
	exit;
fi
fpre=${1%.*}
fext=${1##*.}

setnum=$2
if [ -z $2 ];then
	setnum="1";
fi

cvallist=$3

if [ -z $3 ];then
	cvallist="1 50 100 150 200 300 400 500 700 1000";
fi

echo $1 > ${fpre}_out.log


for cval in $cvallist
do
for i in `seq $setnum`
do

./svm_multiclass_learn.exe -c $cval ${fpre}_train_${i}.${fext} ${fpre}_model_${i}_c${cval}.txt >/dev/null
echo -n ${fpre}_train_${i} $cval " : ">> ${fpre}_out.log
./svm_multiclass_classify.exe ${fpre}_train_${i}.${fext} ${fpre}_model_${i}_c${cval}.txt ${fpre}_train_${i}_out.txt |grep "Zero/one-error" >> ${fpre}_out.log
echo -n ${fpre}_valid_${i} $cval " : ">> ${fpre}_out.log
./svm_multiclass_classify.exe ${fpre}_valid_${i}.${fext} ${fpre}_model_${i}_c${cval}.txt ${fpre}_valid_${i}_out.txt |grep "Zero/one-error" >> ${fpre}_out.log

done
done

rm -rf ${fpre}_train_*_out.txt ${fpre}_valid_*_out.txt

if [ -z $3 ];then
	rm -rf ${fpre}_model_*_c*.txt
fi
~~~


## Reference
1. [excel把一列或多列数据随机打乱顺序排列排序](http://jingyan.baidu.com/article/4f34706eea3609e387b56d88.html)
2. [SVMlight multiclass](http://svmlight.joachims.org/)
3. [svmlight python](https://pypi.python.org/pypi/svmlight)
4. [Resource](http://www-users.cs.umn.edu/~kumar/dmbook/resources.htm)
5. [Ensembles of classifiers](https://en.wikipedia.org/wiki/Ensembles_of_classifiers)

------
