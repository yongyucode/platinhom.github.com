---
layout: post
title: 正则表达式
date: 2015-06-10 01:30:34
categories: Coding
tags: Shell 
---

## [正则表达式](http://zh.wikipedia.org/wiki/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F  ): regexp; regex;

### 工具: [在线正则表达式测试](http://regexpal.com/)

Ref: [30分钟入门教程](http://deerchao.net/tutorials/regex/regex.htm)

### 元字符和字符集

- `具体字符`: 明确匹配
- `.`  除了`\n`外任意一个字符,要包含`\n`需要`(.|\n)`
- `[a0-9]` 字符集, 可用`-`表范围(原`-`需转义)
- `[^abc]` 字符集不包含abc. `^`在字符集中为反义的意思, 反义还有如`\d`反义`\D`
- `\` 转义字符,对`.*?+()\|`等转义
- `^`匹配输入字符串开头,multiline属性可以使其匹配多行.
- `$` 匹配输入字符串末尾,multiline属性可以使其匹配多行.
- `\b` 匹配单词边界(就是空白和标点位置罗),如`er\b` 对于hiver,而非verb
- `\B` 非单词边界,如`er\B` 对于verb,而非hiver
- `\d`数字 `[0-9]`
- `\D` 非数字`[^0-9]`
- `\w` 任何单词字符,包括下划线 `[0-9a-zA-Z_]`
- `\W` 非单词字符,即`[^0-9a-zA-Z_]`
- `\n`,`\r`,`\f`,`\t`,`\v` 匹配换行符,回车符,换页,制表,垂直制表符.
- `\s`任何空白字符, 等价于`[ \f\n\r\t\v]`
- `\S` 任何非空白字符,等价于`[^ \f\n\r\t\v]`

### 数量限定: 跟在字符后面代表数量限制

- `不加限定符` 有且只有一个
- `+` 1个或多个 
- `?` 不多于1个(0或1个)
- `*` 任意个(0或1或多个)
- `{n}` 数量精确n个
- `{n,}` 匹配数量不少于n(>=n).`{1,}`相当于`+`
- `{n,m}` 匹配数量不少于n不多于m.

### 分支选择

- `abc|bcd` 两者其中之一的匹配,遵循优先权法则.
- `a(bcd|hij)z` 使用括号划分分支更有效!

### 贪婪与懒惰

- **贪婪** : 默认情况下尽可能多的匹配,例如`a.*b` 对aabab是匹配aabab.
- **懒惰** : 使用`?`在匹配之后, 表示尽可能少的匹配,如`a.*?b`对aabab匹配aab(1-3)和ab(4-5). 懒惰的使用如`*?`,`+?`,`??`,`{n,}?`,`{n,m}?` 几种情况.
- **最早匹配原则** : 最先开始的匹配拥有最高优先权,此原则高于贪婪和懒惰.所以上例匹配aab而不是ab(2-3).

### 向后引用

- `(exp)` : 匹配exp的内容并归入自动命名的组, 一般组从1开始.
- `(?<Word>exp)`或`(?'Word'exp)` : 将匹配内容归入名为Word的组.
- `\1`以及`\k<Word>`: 将之前匹配的组里的内容进行引用,此处引用自动命名的组1和自定义命名的组Word.
- `(?:exp)`: 非获取匹配, 即不作为分组,不储存,不分组序号. 用途在`arriv(?:e|ing)`中因为要做分支不得不用`()`但又避免进行分组.

> PS: 分组编号实际进行两轮: 首先对无自定义的组进行编号, 再对有别名的组进行编号, 实际有别名的组的编号均大于其余没有别名的组.

### 零宽断言:用于表达位置匹配,如^$/b等作用用于定位

- `(?=exp)`: 断言自身出现的位置的后面能匹配表达式exp,如`\b\w+(?=ing\b)`可以匹配singing的sing
- `(?<=exp)`: 断言自身出现的位置的前面能匹配表达式exp,如`(?<=\bre)\w+\b`匹配reading的ading
- `(?!exp)`: 断言自身出现的位置的后面**不**能匹配表达式exp
- `(?<!exp)`: 断言自身出现的位置的前面**不**能匹配表达式exp

### 优先权

`\`> `()`,`(?:)`, `(?=)`, `[]` > `*`、`+`、`?`、`{n}`、`{n,}`、`{m,n}`>`^`、`$`、`中介字符`>`|`

### 注释

`(?#comment)` 注释,如`(?#这匹配string)`



###例子

~~~~bash
<a[^>]+> #匹配用尖括号括起来的以a开头的字符串。

((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)  #任意IP(<256)

(?<=<(\w+)>).*(?=<\/\1>)    #匹配不包含属性的简单HTML标签内里的内容,注意后面实际是</组1>
~~~~

---
