---
layout: post
title: 自动计算ESP和RESP电荷(AMBER and G09)
date: 2015-09-17 00:22:13
categories: CompCB
tags: CompBiol Bash MD Gaussian
---

我们可以使用高斯对结构进行优化计算拟合ESP电荷,并再利用Ambertool的AnteChamber来转换高斯输出文件结果到指定文件格式,用于计算.这里就是要对小分子结构拟合出ESP和RESP电荷.

## 高斯计算电荷和antechamber拟合电荷

### 关键词: 

`#HF/6-31G* SCF=tight Test Pop=MK iop(6/33=2, 6/42=6, 6/50=1) opt`

- Pop是[population analysis](http://www.gaussian.com/g_tech/g_ur/k_population.htm),用于输出分子轨道,电荷等信息.这里,MK(Merz-Kollman, also known as ESP) atomic charges will be printed out (atomic charges are fitted to the quantum-chemically generated electrostatic potential)
- `iop(6/33=2)`: coordinates of points along with the values of quantum-chemically calculated electrostatic potential in each of them will be printed out. 用于后续计算resp等.
- `iop(6/41=6)` : Number of layers in esp charge fit. 缺省4.也有设6的.现在的antechamber转换都不用这项, 旧教程有用6.
- `iop(6/42=6)` : Density of points per unit area in esp fit.缺省1. 一般使用6. 越大点越多.
- `iop(6/50=1)`: Whether to write Antechamber file during ESP charge fitting. 缺省0. 再算RESP的时候,正常需要使用该项, 这时在输入文件末尾写入两个文件名,可以分别储存开始结构和优化结构的ESP电荷文件.在G09B01中失效..

##### 输入文件例子:

~~~
--Link1--
%nproc=1
%chk=molecule
%mem=1024MB
#HF/6-31G* SCF=tight Test Pop=MK iop(6/33=2) iop(6/42=6) iop(6/50=1) opt

remark line goes here

1   1
    C  -38.9208000000       15.3014000000      -24.0302000000   
    N  -39.4587000000       15.9888000000      -25.0480000000     
    C  -38.8204000000       17.2099000000      -25.1653000000     

antechamber-ini.esp 

antechamber.esp 

~~~

可以自行编辑高斯输入文件输入相应关键词, 也可以使用antechamber辅助: 

~~~bash
# Get Gaussian Input file for esp/resp calculation
antechamber -i ligand.mol2 -fi mol2 -o ligand.gjf -fo gcrt -pf y -gn "%nproc=8" -gm "%mem=1000MB" -ch "ligand" -gk "#HF/6-31G* SCF=tight Test Pop=MK iop(6/33=2) iop(6/42=6) iop(6/50=1) opt" -ge ligand.gesp -gv 1

# Run Gaussian, can also use > ligand.out to assign output file
g09 ligand.gjf

# Use Gaussian output to get resp, also "-c esp" to get esp charge
antechamber -i ligand.log -fi gout -o ligand_resp.mol2 -fo mol2 -pf y -c resp
# The following use gesp file to get resp charge
# antechamber -i ligand.gesp -fi gesp -o ligand_resp.mol2 -fo mol2 -pf y -c resp

# To get amber parameter file
antechamber -i ligand_resp.mol2 -fi mol2 -o ligand_resp.prep -fo prepi
parmchk -i ligand_resp.prep -f prepi -o ligand_resp.frcmod
~~~

这里, 

- `-fo gcrt`指明输出高斯输入类型文件, `-fi`是输入文件类型, `-i`, `-o`分别是输入和输出文件, `-pf y`是不产生中间文件.
- `-gn`指明cpu数量, `-gm`是内存指明,`-ch`是chk文件名(默认"molecule"),均需要双引号!
- `-gk`是关键词指明(不输入就会自动产生我上面那句话); `-gv 1`是写出resp文件的选项,使用后会加入"#iop(6/50=1)", g09开始支持, 也可以使用-gk自己写入; `-ge`是输出的gesp文件名(默认g09.gesp,写在高斯输入文件名后面),用于后续拟合,必须在`-gv 1`下才有效. 
- `-c`指明拟合原子电荷的方法.

随后使用g09计算即可. 算出结果后, g09RevC以后会产生相应gesp文件,可以用gesp文件拟合,也可以用输出文件log/out去拟合(见上述指令).在输出文件当中, 已经存在了Mulliken和ESP原子电荷(还有把H电荷分到重原子时的电荷,一般使用全原子电荷), 因此可以很方便直接拟合出相应`mul`和`esp`电荷.

------

然而, 在我的使用当中, ESP电荷是毫无问题的, 但是RESP电荷就出问题了. RESP电荷计算是通过加入iop(6/50=1)来开启写出esp文件,从而使得antechamber可以读入该esp文件进行RESP的拟合.然而,在G09的Rev B.01中, 由于存在bug, 并不能实现该功能, 并且计算结果中只存在电荷中心坐标, 没有相应输出相应坐标的电荷值. 找了一天,在Amber的bugfix中找到了解决方案: 

[Gaussian 09 fix](http://ambermd.org/bugfixesat.html)  
In Gaussian09 rev B.01, the facility to write out the electrostatic potential on a grid of points was inadvertently deleted. This means that antechamber and resp jobs won't work as they should. Fernando Clemente of Gaussian has kindly provided a script to work around the problem. Download the [fixreadinesp.sh](http://ambermd.org/fixreadinesp.sh) file, and follow the instructions there. (Note: you will have to make the script executable by typing `chmod +x fixreadinesp.sh`.)

##### [fixreadinesp.sh](http://ambermd.org/fixreadinesp.sh)

~~~bash
#!/bin/bash
######################################################################
#
# "fixreadinesp.awk" by Fernando R. Clemente (Gaussian, Inc.)
#
#  Workaround for G09 rev. B.01 not printing the list of
#   electrostatic potential values at the grid points in
#   "Pop=ESP" jobs with "IOp(6/33=2)":
#
#  1) Run the "Pop=ESP" jobs with "IOp(6/33=2)" as you would
#     normally do.
#  2) Run this script on the output of job 1) and redirect to
#     a new Gaussian input file. This will extract the list of
#     grid points and setup a new job in which this list is given
#     explicitly in the input file. This second Gaussian job
#     uses the results saved in the checkpoint file of job 1),
#     so the QM calculation does not need to be redone. Example:
#
#       fixreadinesp.sh output.log > readincenters.com
#
#  3) Run the new Gaussian job with the generated input file in
#     step 2) in order to obtain a G09 output file that contains
#     the values of the electrostatic potential at each grid point.
#
#  4) Re-run this script on the G09 output file generated by step 3)
#     to fix the format so "espgen" is able to read this type of
#     Gaussian output file. Example:
#
#       fixreadinesp.sh readincenters.log > fixed.log
#
#  This final Gaussian output file should work with "espgen".
#
######################################################################
#
# Extracts list of grid points from a G09 output file
#  and sets up an Gaussian input file to re-run the job
#  with the list of points given explicitly.
#
if [ "$(grep "Charges from ESP fit" ${1})" != "" ] ; then
  printf "%s\n" "$(grep -i "%chk=" ${1})"
  printf "#p geom=allcheck chkbas guess=(read,only) density=check\n"
  printf "nosymm prop=(potential,read) pop=minimal\n\n"
  grep "ESP Fit Center" ${1} | cut -c32- -
  printf "\n"
else
  # Fixes the output of a G09 job with
  #  read-in values to make "espgen" be
  #  able to recognize the list of centers
  #  and the electrostatic potential values.
  awk '
  {
    if ($0 ~ /Electric Field/) {
      while ($0 !~ /Atom/) { print $0 ; getline }
      while ($0 ~ /Atom/) { print $0 ; getline }
      while ($0 !~ /^ ------/) {
        CENTERID=$1
        OLDSTR=sprintf("%i    ",CENTERID)
        NEWSTR=sprintf("%i Fit",CENTERID)
        sub(OLDSTR,NEWSTR,$0)
        print $0
        getline
        }
      }
    sub(/Read-in Center/,"ESP Fit Center",$0)
    print $0
  }' ${1}
  fi
######################################################################
~~~

文件中有使用说明,就是将计算的结果先作为脚本输入文件,输出到一个文件作为高斯输入文件(包含charge center坐标). 再进行一次计算(此时,保证chk文件的存在!!chk文件名会自行从输出文件中获取), 提取相应电荷点和电荷值, 很快就算完了.随后在第二次计算结果作为输入再利用脚本进行一次处理, 转换成antechamber能识别的输出文件即可. 相应就是:

~~~bash
chmod +x fixreadinesp.sh
./fixreadinesp.sh ligand.log > tmpesp.gjf
g09 tmpesp.gjf > tmpesp.log
./fixreadinesp.sh tmpesp.log > ligand.out 
antechamber -i ligand.out -fi gout -o ligand_resp.mol2 -fo mol2 -pf y -c resp
~~~

中间第二部g09计算的输入文件抬头:

~~~
 %chk=ligand
#p geom=allcheck chkbas guess=(read,only) density=check
nosymm prop=(potential,read) pop=minimal

   1.208000  0.697100  2.100000
	................
~~~

但随之使用后发现拟合的电荷十分之大! 再搜索后发现在amber的archive里面有讨论该问题, 简而言之就是计算ESP电荷时会进行对称化优化操作,而使用工具提取格点坐标和电荷时使用了`nosymm`关键词, 从而导致结构的坐标不一致. 解决方案就是在计算ESP时加入nosymm或者在fixreadinesp.sh工具输出gjf文件后去掉nosymm(或者去掉fixreadinesp.sh中的nosymm).

Another [Problem](http://archive.ambermd.org/201108/0726.html) is the calculation result is very strange if you just use the standard method and the fixreadinesp.sh tool. Because of the use of "nosymm" in the second part extraction of fit charge from chk file, the coordinates may be different to the origin calculation. So, the final charge on atom summaried from the grid may be wrong. To solve this problem, just need to add nosymm in the first calculation, or remove the nosymm in the second gaussian input file generated by fixreadinesp.sh.

还有个问题...就是输出文件charge center超过10000后, 编号会变成`****`! 这样在最后输出ligand.out用于拟合电荷的文件时,`****`部分不能利用脚本补充 **Fit** 一词..原因是因为原来的脚本中替换加入`Fit`是这样处理的,用整形.`%i`,但`****`就不能处理了...

~~~bash
        OLDSTR=sprintf("%i    ",CENTERID)
        NEWSTR=sprintf("%i Fit",CENTERID)
~~~

因此建议更改脚本该部分为:

~~~bash
        OLDSTR=sprintf("%s    ",CENTERID)
        NEWSTR=sprintf("%s Fit",CENTERID)
~~~

另外要是不加opt关键词, 使用antechamber拟合ESP电荷时电荷为0...虽然高斯输出中有电荷,但没有正常用antechamber来读出...迟点自己写个脚本提取...

**Update**: 给作者写邮件指出问题后, 作者很快就回复了并给出了新的脚本, 效率很快啊~

~~~ bash
#!/bin/bash
######################################################################
#
# "fixreadinesp.sh" by Fernando R. Clemente (Gaussian, Inc.)
#                      ( September 2015 )
#
#  Workaround for G09 rev. B.01 not printing the list of 
#   electrostatic potential values at the grid points in
#   "Pop=ESP" jobs with "IOp(6/33=2)":
#
#  1) Run the "Pop=ESP" jobs with "IOp(6/33=2)" as you would
#     normally do.
#  2) Run this script on the output of job 1) and redirect to
#     a new Gaussian input file. This will extract the list of
#     grid points and setup a new job in which this list is given
#     explicitly in the input file. This second Gaussian job
#     uses the results saved in the checkpoint file of job 1),
#     so the QM calculation does not need to be redone. Example:
#
#       fixreadinesp.sh output.log > readincenters.com
#
#  3) Run the new Gaussian job with the generated input file in 
#     step 2) in order to obtain a G09 output file that contains
#     the values of the electrostatic potential at each grid point.
#
#  4) Re-run this script on the G09 output file generated by step 3)
#     to fix the format so "espgen" is able to read this type of 
#     Gaussian output file. Example:
#
#       fixreadinesp.sh readincenters.log > fixed.log
#
#  This final Gaussian output file should work with "espgen".
#
######################################################################
#
# Extracts list of grid points from a G09 output file 
#  and sets up an Gaussian input file to re-run the job
#  with the list of points given explicitly.
#
if [ "$(grep "Charges from ESP fit" ${1})" != "" ] ; then
  printf "%s\n" "$(grep -i "%chk=" ${1} | cut -c2-)"
  printf "#p chkbas guess=(read,only) density=check\n"
  printf "nosymm prop=(potential,read) pop=minimal\n\n"
  printf "ESP fit with read-in centers\n\n"
  awk '/Charge =... Multiplicity =../ { printf("%s %s\n",substr($0,10,3),substr($0,28,2)) }' ${1}
  awk '
  /Merz-Kollman atomic radii used/ {
    ATNO=0
    while ($1 !~ /^1/) { getline }
    while ($0 !~ /^ Generate VDW surfaces/) { ATNO++ ; AT[ATNO]=$2 ; getline }
    while ($0 !~ /Atomic Center/) { getline }
    ATNO=0
    while ($0 ~ /Atomic Center/) { ATNO++ ; XYZ[ATNO]=substr($0,32,31) ; getline }
    NATOMS=ATNO
    PT=0
    while ($0 ~ /ESP Fit Center/) { PT++ ; FITXYZ[PT]=substr($0,32,31) ; getline }
    NPT=PT
    }
  END { 
    for (I=1;I<=NATOMS;I++) { printf("%3i  %s\n",AT[I],XYZ[I]) }
    printf("\n")
    for (I=1;I<=NPT;I++) { printf(" %s\n",FITXYZ[I]) }
    printf("\n")
    }' ${1}
else
  # Fixes the output of a G09 job with 
  #  read-in values to make "espgen" be
  #  able to recognize the list of centers
  #  and the electrostatic potential values.
  awk '
  {
    if ($0 ~ /Z-Matrix orientation:/) { sub(/Z-Matrix orientation:/,"   Input orientation:",$0) }
    if ($0 ~ /Electric Field/) { 
      while ($0 !~ /Atom/) { print $0 ; getline } 
      while ($0 ~ /Atom/) { print $0 ; getline }
      while ($0 !~ /^ ------/) {
  FIRST=substr($0,1,5)
  LAST=substr($0,11)
  printf("%s Fit %s\n",FIRST,LAST)
        getline
        }
      }
    sub(/Read-in Center/,"ESP Fit Center",$0)
    print $0
  }' ${1}
  fi
######################################################################
~~~

##### 自动进行ESP/RESP电荷计算脚本

Gaussian B.01使用. nosymm处理, 已更改fixreadinesp.sh中`%i`为`%s`.

~~~bash
#! /bin/bash
# Usage: Calculate Molecule ESP/RESP charge via Amber/G09.
# Input: molecule file in pdb/mol2 format
# Author: Zhixiong Zhao 2015-9-17

if [ -z $1 ];then
echo "Please assign the input file!"
exit
fi

# If you use G09 Rev B.01, uncomment the following line to fix bug
# G09B01="TRUE"

#Setup the amber/Gaussian environment. You should modify by your own environment
if [ -z $AMBERHOME ];then
source /mnt/home/zhaozx/AmberTools/amber.sh
fi

if [ -z $g09root ];then
source /mnt/home/zhaozx/Software/g09/gau_setup.sh
fi

basename=${1%.*}
exdname=${1##*.}

if [ $exdname = "mol2" ];then
antechamber -fi mol2 -fo gcrt -pf y -i $1  -o ${basename}.gjf -gn "%nproc=8" -gm "%mem=1000MB" -gk "#HF/6-31G* SCF=tight Test Pop=MK iop(6/33=2) iop(6/42=6) iop(6/50=1) opt nosymm" -ch "${basename}" -ge ${basename}.gesp -gv 1
elif [ $exdname = "pdb" ];then
antechamber -fi pdb -fo gcrt -pf y -i $1 -o ${basename}.gjf -gn "%nproc=8" -gm "%mem=1000MB" -gk "#HF/6-31G* SCF=tight Test Pop=MK iop(6/33=2) iop(6/42=6) iop(6/50=1) opt nosymm" -ch "${basename}" -ge ${basename}.gesp -gv 1
else
echo "Only support for pdb or mol2 files!"
exit
fi

g09 ${basename}.gjf
antechamber -fi gout -fo mol2 -pf y -i ${basename}.log -o ${basename}_esp.mol2 -c esp

# Fix bug in G09 Rev B.01
if [ ! -z $G09B01 ];then
# Generate bugfix tool fixreadinesp.sh developed by Fernando Clemente of Gaussian
# http://ambermd.org/fixreadinesp.sh

if [ ! -f fixreadinesp.sh ];then
echo "#!/bin/bash" > fixreadinesp.sh
echo "if [ \"\$(grep \"Charges from ESP fit\" \${1})\" != \"\" ] ; then" >> fixreadinesp.sh
echo "  printf \"%s\n\" \"\$(grep -i \"%chk=\" \${1})\"" >> fixreadinesp.sh
echo "  printf \"#p geom=allcheck chkbas guess=(read,only) density=check\n\"" >> fixreadinesp.sh
echo "  printf \"nosymm prop=(potential,read) pop=minimal\n\n\"" >> fixreadinesp.sh
echo "  grep \"ESP Fit Center\" \${1} | cut -c32- -" >> fixreadinesp.sh
echo "  printf \"\n\"" >> fixreadinesp.sh
echo "else" >> fixreadinesp.sh
echo "  awk '" >> fixreadinesp.sh
echo "  {" >> fixreadinesp.sh
echo "    if (\$0 ~ /Electric Field/) { " >> fixreadinesp.sh
echo "      while (\$0 !~ /Atom/) { print \$0 ; getline } " >> fixreadinesp.sh
echo "      while (\$0 ~ /Atom/) { print \$0 ; getline }" >> fixreadinesp.sh
echo "      while (\$0 !~ /^ ------/) {" >> fixreadinesp.sh
echo "        CENTERID=\$1" >> fixreadinesp.sh
echo "        OLDSTR=sprintf(\"%s    \",CENTERID)" >> fixreadinesp.sh
echo "        NEWSTR=sprintf(\"%s Fit\",CENTERID)" >> fixreadinesp.sh
echo "        sub(OLDSTR,NEWSTR,\$0)" >> fixreadinesp.sh
echo "        print \$0" >> fixreadinesp.sh
echo "        getline" >> fixreadinesp.sh
echo "        }" >> fixreadinesp.sh
echo "      }" >> fixreadinesp.sh
echo "    sub(/Read-in Center/,\"ESP Fit Center\",\$0)" >> fixreadinesp.sh
echo "    print \$0" >> fixreadinesp.sh
echo "  }' \${1}" >> fixreadinesp.sh
echo "  fi" >> fixreadinesp.sh
chmod +x fixreadinesp.sh
fi

./fixreadinesp.sh ${basename}.log > tmpesp.gjf
g09 tmpesp.gjf
./fixreadinesp.sh tmpesp.log > ${basename}.out
antechamber -fi gout -fo mol2 -pf y -i ${basename}.out -o ${basename}_resp.mol2 -c resp
rm punch qout QOUT esout tmpesp.gjf tmpesp.log

else
# G09 Rev C01/D01
antechamber -fi gesp -fo mol2 -pf y -i ${basename}.gesp -o ${basename}_resp.mol2 -c resp
rm punch qout QOUT esout 

fi # End different Version for resp
echo "Done for $basename!"
~~~

## 测试

同一类型由上到下顺序分别是(gesp文件只有D.01才有):

1. D.01版相同分子测试,带nosymm
2. D.01版相同分子测试,不带nosymm
3. B.01版相同分子测试,带nosymm
4. B.01版相同分子测试,不带nosymm

### ESP, 跟log输出文件一致

~~~
      1 C1          1.1550    0.6590   -0.0420 ca        1 MOL     -0.192863
      2 C2          2.4130    1.4800    0.0700 c3        1 MOL      0.371372
      3 H1          2.1600    2.5350    0.0440 h1        1 MOL      0.001563
      4 O1          3.2910    1.1610   -0.9900 oh        1 MOL     -0.673059
      5 H2          4.0950    1.6510   -0.8880 ho        1 MOL      0.412009
      6 H3          2.8990    1.2760    1.0210 h1        1 MOL     -0.026595
      7 C3         -0.0770    1.2760   -0.1580 ca        1 MOL     -0.117862
      8 H4         -0.1210    2.3480   -0.2150 ha        1 MOL      0.115217
      9 C4         -1.2630    0.5510   -0.1970 ca        1 MOL      0.072899
     10 S1         -2.8330    1.3820   -0.3880 sh        1 MOL     -0.300690
     11 H5         -3.1360    1.5470    0.8960 hs        1 MOL      0.161915
     12 C5         -1.1910   -0.8320   -0.1410 ca        1 MOL     -0.030450
     13 H6         -2.0930   -1.4150   -0.1850 ha        1 MOL      0.108941
     14 C6          0.0300   -1.4710   -0.0390 ca        1 MOL     -0.442495
     15 H7          0.0680   -2.5460   -0.0010 ha        1 MOL      0.208991
     16 C7          1.2150   -0.7420    0.0100 ca        1 MOL      0.498549
     17 N1          2.4400   -1.3810    0.1590 nh        1 MOL     -0.958993
     18 H8          3.1850   -0.9370   -0.3330 hn        1 MOL      0.401655
     19 H9          2.4130   -2.3620   -0.0210 hn        1 MOL      0.389897

      1 C1          0.8450   -0.4030   -0.1980 ca        1 MOL     -0.204288
      2 C2          1.9750   -1.3720   -0.4250 c3        1 MOL      0.357895
      3 H1          1.5770   -2.3780   -0.5140 h1        1 MOL      0.006281
      4 O1          2.8910   -1.3020    0.6480 oh        1 MOL     -0.670388
      5 H2          3.6190   -1.8840    0.4770 ho        1 MOL      0.412521
      6 H3          2.4830   -1.1300   -1.3560 h1        1 MOL     -0.021984
      7 C3         -0.4610   -0.8520   -0.1310 ca        1 MOL     -0.099205
      8 H4         -0.6550   -1.9080   -0.1960 ha        1 MOL      0.110730
      9 C4         -1.5340    0.0210    0.0110 ca        1 MOL      0.062863
     10 S1         -3.2040   -0.6010    0.1340 sh        1 MOL     -0.299507
     11 H5         -3.5300   -0.5740   -1.1540 hs        1 MOL      0.162118
     12 C5         -1.2700    1.3780    0.1110 ca        1 MOL     -0.026887
     13 H6         -2.0810    2.0710    0.2370 ha        1 MOL      0.108836
     14 C6          0.0290    1.8480    0.0610 ca        1 MOL     -0.445057
     15 H7          0.2170    2.9040    0.1440 ha        1 MOL      0.208296
     16 C7          1.1000    0.9730   -0.0910 ca        1 MOL      0.506061
     17 N1          2.4020    1.4480   -0.1890 nh        1 MOL     -0.961354
     18 H8          3.0790    0.8510    0.2360 hn        1 MOL      0.402173
     19 H9          2.5130    2.3950    0.1020 hn        1 MOL      0.390895

      1 C1          1.1550    0.6580   -0.0420 ca        1 MOL     -0.192720
      2 C2          2.4130    1.4790    0.0710 c3        1 MOL      0.370896
      3 H1          2.1600    2.5340    0.0440 h1        1 MOL      0.001774
      4 O1          3.2910    1.1600   -0.9890 oh        1 MOL     -0.673062
      5 H2          4.0950    1.6510   -0.8870 ho        1 MOL      0.412057
      6 H3          2.8990    1.2760    1.0220 h1        1 MOL     -0.026466
      7 C3         -0.0770    1.2760   -0.1580 ca        1 MOL     -0.117905
      8 H4         -0.1210    2.3480   -0.2150 ha        1 MOL      0.115115
      9 C4         -1.2630    0.5510   -0.1970 ca        1 MOL      0.073215
     10 S1         -2.8330    1.3830   -0.3870 sh        1 MOL     -0.300670
     11 H5         -3.1360    1.5470    0.8960 hs        1 MOL      0.161789
     12 C5         -1.1920   -0.8320   -0.1410 ca        1 MOL     -0.030626
     13 H6         -2.0930   -1.4150   -0.1860 ha        1 MOL      0.108998
     14 C6          0.0300   -1.4710   -0.0400 ca        1 MOL     -0.442596
     15 H7          0.0680   -2.5460   -0.0020 ha        1 MOL      0.209051
     16 C7          1.2150   -0.7420    0.0090 ca        1 MOL      0.498516
     17 N1          2.4390   -1.3820    0.1590 nh        1 MOL     -0.958883
     18 H8          3.1850   -0.9370   -0.3330 hn        1 MOL      0.401638
     19 H9          2.4130   -2.3620   -0.0220 hn        1 MOL      0.389881

      1 C1         -0.8450   -0.4030    0.1980 ca        1 MOL     -0.198304
      2 C2         -1.9750   -1.3730    0.4250 c3        1 MOL      0.355612
      3 H1         -1.5770   -2.3780    0.5140 h1        1 MOL      0.006917
      4 O1         -2.8910   -1.3020   -0.6480 oh        1 MOL     -0.671186
      5 H2         -3.6190   -1.8850   -0.4760 ho        1 MOL      0.413065
      6 H3         -2.4830   -1.1310    1.3560 h1        1 MOL     -0.022323
      7 C3          0.4610   -0.8520    0.1310 ca        1 MOL     -0.105486
      8 H4          0.6550   -1.9080    0.1950 ha        1 MOL      0.113032
      9 C4          1.5340    0.0210   -0.0110 ca        1 MOL      0.062586
     10 S1          3.2040   -0.6010   -0.1340 sh        1 MOL     -0.299580
     11 H5          3.5290   -0.5730    1.1550 hs        1 MOL      0.162243
     12 C5          1.2700    1.3780   -0.1110 ca        1 MOL     -0.026940
     13 H6          2.0810    2.0710   -0.2370 ha        1 MOL      0.108969
     14 C6         -0.0290    1.8480   -0.0610 ca        1 MOL     -0.442838
     15 H7         -0.2170    2.9040   -0.1440 ha        1 MOL      0.207678
     16 C7         -1.1000    0.9730    0.0910 ca        1 MOL      0.505230
     17 N1         -2.4020    1.4480    0.1890 nh        1 MOL     -0.962495
     18 H8         -3.0790    0.8510   -0.2360 hn        1 MOL      0.402874
     19 H9         -2.5130    2.3950   -0.1020 hn        1 MOL      0.390946
~~~

### RESP,opt structure(from gesp)

~~~
      1 C1          1.1550    0.6590   -0.0420 ca        1 MOL     -0.156662
      2 C2          2.4130    1.4800    0.0700 c3        1 MOL      0.325359
      3 H1          2.1600    2.5350    0.0440 h1        1 MOL     -0.001825
      4 O1          3.2910    1.1610   -0.9900 oh        1 MOL     -0.658991
      5 H2          4.0950    1.6510   -0.8880 ho        1 MOL      0.410987
      6 H3          2.8990    1.2760    1.0210 h1        1 MOL     -0.001825
      7 C3         -0.0770    1.2760   -0.1580 ca        1 MOL     -0.125750
      8 H4         -0.1210    2.3480   -0.2150 ha        1 MOL      0.115495
      9 C4         -1.2630    0.5510   -0.1970 ca        1 MOL      0.073429
     10 S1         -2.8330    1.3820   -0.3880 sh        1 MOL     -0.299423
     11 H5         -3.1360    1.5470    0.8960 hs        1 MOL      0.161763
     12 C5         -1.1910   -0.8320   -0.1410 ca        1 MOL     -0.039819
     13 H6         -2.0930   -1.4150   -0.1850 ha        1 MOL      0.110328
     14 C6          0.0300   -1.4710   -0.0390 ca        1 MOL     -0.415901
     15 H7          0.0680   -2.5460   -0.0010 ha        1 MOL      0.200811
     16 C7          1.2150   -0.7420    0.0100 ca        1 MOL      0.462337
     17 N1          2.4400   -1.3810    0.1590 nh        1 MOL     -0.947570
     18 H8          3.1850   -0.9370   -0.3330 hn        1 MOL      0.393629
     19 H9          2.4130   -2.3620   -0.0210 hn        1 MOL      0.393629

      1 C1          0.8450   -0.4030   -0.1980 ca        1 MOL     -0.165459
      2 C2          1.9750   -1.3720   -0.4250 c3        1 MOL      0.310672
      3 H1          1.5770   -2.3780   -0.5140 h1        1 MOL      0.003116
      4 O1          2.8910   -1.3020    0.6480 oh        1 MOL     -0.656692
      5 H2          3.6190   -1.8840    0.4770 ho        1 MOL      0.411755
      6 H3          2.4830   -1.1300   -1.3560 h1        1 MOL      0.003116
      7 C3         -0.4610   -0.8520   -0.1310 ca        1 MOL     -0.109224
      8 H4         -0.6550   -1.9080   -0.1960 ha        1 MOL      0.111286
      9 C4         -1.5340    0.0210    0.0110 ca        1 MOL      0.065359
     10 S1         -3.2040   -0.6010    0.1340 sh        1 MOL     -0.298425
     11 H5         -3.5300   -0.5740   -1.1540 hs        1 MOL      0.161931
     12 C5         -1.2700    1.3780    0.1110 ca        1 MOL     -0.038510
     13 H6         -2.0810    2.0710    0.2370 ha        1 MOL      0.110611
     14 C6          0.0290    1.8480    0.0610 ca        1 MOL     -0.416449
     15 H7          0.2170    2.9040    0.1440 ha        1 MOL      0.199881
     16 C7          1.1000    0.9730   -0.0910 ca        1 MOL      0.467910
     17 N1          2.4020    1.4480   -0.1890 nh        1 MOL     -0.949833
     18 H8          3.0790    0.8510    0.2360 hn        1 MOL      0.394478
     19 H9          2.5130    2.3950    0.1020 hn        1 MOL      0.394478
~~~

### RESP, ini structure(from gesp)

~~~
      1 C1          1.2080    0.6970    0.0000 ca        1 MOL     -0.257815
      2 C2          2.4950    1.4410    0.0000 c3        1 MOL      0.340462
      3 H1          2.2950    2.5120    0.0000 h1        1 MOL     -0.018413
      4 O1          3.2380    1.0990   -1.1580 oh        1 MOL     -0.633372
      5 H2          4.0610    1.5930   -1.1310 ho        1 MOL      0.395844
      6 H3          3.0660    1.1780    0.8900 h1        1 MOL     -0.018413
      7 C3          0.0000    1.3950    0.0000 ca        1 MOL     -0.107945
      8 H4          0.0000    2.4820    0.0000 ha        1 MOL      0.218270
      9 C4         -1.2080    0.6980    0.0000 ca        1 MOL     -0.031004
     10 S1         -2.7370    1.5800    0.0000 sh        1 MOL     -0.403760
     11 H5         -3.7520    0.7120    0.0000 hs        1 MOL      0.254530
     12 C5         -1.2080   -0.6980    0.0000 ca        1 MOL     -0.031282
     13 H6         -2.1490   -1.2410    0.0000 ha        1 MOL      0.136449
     14 C6          0.0000   -1.3950    0.0000 ca        1 MOL     -0.453574
     15 H7          0.0000   -2.4820    0.0000 ha        1 MOL      0.199507
     16 C7          1.2080   -0.6980    0.0000 ca        1 MOL      0.631395
     17 N1          2.4190   -1.3970    0.0000 nh        1 MOL     -1.110707
     18 H8          3.2930   -0.8910    0.0000 hn        1 MOL      0.444914
     19 H9          2.4190   -2.4070    0.0000 hn        1 MOL      0.444914

      1 C1          0.8530   -0.4100   -0.2240 ca        1 MOL     -0.278993
      2 C2          1.9900   -1.3480   -0.4080 c3        1 MOL      0.349096
      3 H1          1.6110   -2.3670   -0.4880 h1        1 MOL     -0.019875
      4 O1          2.8640   -1.2560    0.7050 oh        1 MOL     -0.632241
      5 H2          3.5870   -1.8710    0.5590 ho        1 MOL      0.394561
      6 H3          2.5320   -1.0890   -1.3170 h1        1 MOL     -0.019875
      7 C3         -0.4530   -0.8990   -0.1790 ca        1 MOL     -0.095439
      8 H4         -0.6380   -1.9650   -0.2790 ha        1 MOL      0.216303
      9 C4         -1.5220   -0.0190   -0.0070 ca        1 MOL     -0.033467
     10 S1         -3.1740   -0.6370    0.0490 sh        1 MOL     -0.403503
     11 H5         -4.0240    0.3800    0.2210 hs        1 MOL      0.254100
     12 C5         -1.2840    1.3500    0.1220 ca        1 MOL     -0.033933
     13 H6         -2.1160    2.0360    0.2570 ha        1 MOL      0.139010
     14 C6          0.0220    1.8380    0.0780 ca        1 MOL     -0.460436
     15 H7          0.2070    2.9050    0.1780 ha        1 MOL      0.200621
     16 C7          1.0900    0.9590   -0.0950 ca        1 MOL      0.647870
     17 N1          2.3990    1.4480   -0.1390 nh        1 MOL     -1.113780
     18 H8          3.1720    0.8100   -0.2650 hn        1 MOL      0.444990
     19 H9          2.5710    2.4390   -0.0460 hn        1 MOL      0.444990
~~~

### RESP, Fix.sh `%i`

~~~
      1 C1          1.1550    0.6590   -0.0420 ca        1 MOL     -0.161751
      2 C2          2.4130    1.4800    0.0700 c3        1 MOL      0.333577
      3 H1          2.1600    2.5350    0.0440 h1        1 MOL     -0.011242
      4 O1          3.2910    1.1610   -0.9900 oh        1 MOL     -0.599179
      5 H2          4.0950    1.6510   -0.8880 ho        1 MOL      0.371756
      6 H3          2.8990    1.2760    1.0210 h1        1 MOL     -0.011242
      7 C3         -0.0770    1.2760   -0.1580 ca        1 MOL     -0.148060
      8 H4         -0.1210    2.3480   -0.2150 ha        1 MOL      0.112207
      9 C4         -1.2630    0.5510   -0.1970 ca        1 MOL      0.128114
     10 S1         -2.8330    1.3820   -0.3880 sh        1 MOL     -0.276854
     11 H5         -3.1360    1.5470    0.8960 hs        1 MOL      0.142380
     12 C5         -1.1910   -0.8320   -0.1410 ca        1 MOL     -0.105482
     13 H6         -2.0930   -1.4150   -0.1850 ha        1 MOL      0.116274
     14 C6          0.0300   -1.4710   -0.0390 ca        1 MOL     -0.315181
     15 H7          0.0680   -2.5460   -0.0010 ha        1 MOL      0.159579
     16 C7          1.2150   -0.7420    0.0100 ca        1 MOL      0.419384
     17 N1          2.4400   -1.3810    0.1590 nh        1 MOL     -0.838418
     18 H8          3.1850   -0.9370   -0.3330 hn        1 MOL      0.342069
     19 H9          2.4130   -2.3620   -0.0210 hn        1 MOL      0.342069

      1 C1          0.8450   -0.4030   -0.1980 ca        1 MOL     -0.197801
      2 C2          1.9750   -1.3720   -0.4250 c3        1 MOL      0.332137
      3 H1          1.5770   -2.3780   -0.5140 h1        1 MOL     -0.009912
      4 O1          2.8910   -1.3020    0.6480 oh        1 MOL     -0.598844
      5 H2          3.6190   -1.8840    0.4770 ho        1 MOL      0.372008
      6 H3          2.4830   -1.1300   -1.3560 h1        1 MOL     -0.009912
      7 C3         -0.4610   -0.8520   -0.1310 ca        1 MOL     -0.093596
      8 H4         -0.6550   -1.9080   -0.1960 ha        1 MOL      0.104183
      9 C4         -1.5340    0.0210    0.0110 ca        1 MOL      0.057735
     10 S1         -3.2040   -0.6010    0.1340 sh        1 MOL     -0.270447
     11 H5         -3.5300   -0.5740   -1.1540 hs        1 MOL      0.150700
     12 C5         -1.2700    1.3780    0.1110 ca        1 MOL     -0.061126
     13 H6         -2.0810    2.0710    0.2370 ha        1 MOL      0.110181
     14 C6          0.0290    1.8480    0.0610 ca        1 MOL     -0.339422
     15 H7          0.2170    2.9040    0.1440 ha        1 MOL      0.159005
     16 C7          1.1000    0.9730   -0.0910 ca        1 MOL      0.450824
     17 N1          2.4020    1.4480   -0.1890 nh        1 MOL     -0.839315
     18 H8          3.0790    0.8510    0.2360 hn        1 MOL      0.341801
     19 H9          2.5130    2.3950    0.1020 hn        1 MOL      0.341801

      1 C1          1.1550    0.6580   -0.0420 ca        1 MOL     -0.162088
      2 C2          2.4130    1.4790    0.0710 c3        1 MOL      0.333112
      3 H1          2.1600    2.5340    0.0440 h1        1 MOL     -0.011087
      4 O1          3.2910    1.1600   -0.9890 oh        1 MOL     -0.599158
      5 H2          4.0950    1.6510   -0.8870 ho        1 MOL      0.371796
      6 H3          2.8990    1.2760    1.0220 h1        1 MOL     -0.011087
      7 C3         -0.0770    1.2760   -0.1580 ca        1 MOL     -0.147541
      8 H4         -0.1210    2.3480   -0.2150 ha        1 MOL      0.111988
      9 C4         -1.2630    0.5510   -0.1970 ca        1 MOL      0.127889
     10 S1         -2.8330    1.3830   -0.3870 sh        1 MOL     -0.276796
     11 H5         -3.1360    1.5470    0.8960 hs        1 MOL      0.142292
     12 C5         -1.1920   -0.8320   -0.1410 ca        1 MOL     -0.105290
     13 H6         -2.0930   -1.4150   -0.1860 ha        1 MOL      0.116207
     14 C6          0.0300   -1.4710   -0.0400 ca        1 MOL     -0.315288
     15 H7          0.0680   -2.5460   -0.0020 ha        1 MOL      0.159498
     16 C7          1.2150   -0.7420    0.0090 ca        1 MOL      0.419934
     17 N1          2.4390   -1.3820    0.1590 nh        1 MOL     -0.838427
     18 H8          3.1850   -0.9370   -0.3330 hn        1 MOL      0.342023
     19 H9          2.4130   -2.3620   -0.0220 hn        1 MOL      0.342023

      1 C1         -0.8450   -0.4030    0.1980 ca        1 MOL     -0.002460
      2 C2         -1.9750   -1.3730    0.4250 c3        1 MOL     -0.357360
      3 H1         -1.5770   -2.3780    0.5140 h1        1 MOL      0.209924
      4 O1         -2.8910   -1.3020   -0.6480 oh        1 MOL     -0.518857
      5 H2         -3.6190   -1.8850   -0.4760 ho        1 MOL      0.379120
      6 H3         -2.4830   -1.1310    1.3560 h1        1 MOL      0.209924
      7 C3          0.4610   -0.8520    0.1310 ca        1 MOL      0.079757
      8 H4          0.6550   -1.9080    0.1950 ha        1 MOL      0.006852
      9 C4          1.5340    0.0210   -0.0110 ca        1 MOL     -0.259404
     10 S1          3.2040   -0.6010   -0.1340 sh        1 MOL     -0.160999
     11 H5          3.5290   -0.5730    1.1550 hs        1 MOL      0.146076
     12 C5          1.2700    1.3780   -0.1110 ca        1 MOL      0.191306
     13 H6          2.0810    2.0710   -0.2370 ha        1 MOL      0.034480
     14 C6         -0.0290    1.8480   -0.0610 ca        1 MOL     -0.457445
     15 H7         -0.2170    2.9040   -0.1440 ha        1 MOL      0.173420
     16 C7         -1.1000    0.9730    0.0910 ca        1 MOL      0.469661
     17 N1         -2.4020    1.4480    0.1890 nh        1 MOL     -0.879408
     18 H8         -3.0790    0.8510   -0.2360 hn        1 MOL      0.367707
     19 H9         -2.5130    2.3950   -0.1020 hn        1 MOL      0.367707
~~~

### RESP, Fix.sh `%s`

~~~
      1 C1          1.1550    0.6590   -0.0420 ca        1 MOL     -0.130447
      2 C2          2.4130    1.4800    0.0700 c3        1 MOL      0.333350
      3 H1          2.1600    2.5350    0.0440 h1        1 MOL     -0.003752
      4 O1          3.2910    1.1610   -0.9900 oh        1 MOL     -0.662975
      5 H2          4.0950    1.6510   -0.8880 ho        1 MOL      0.411752
      6 H3          2.8990    1.2760    1.0210 h1        1 MOL     -0.003752
      7 C3         -0.0770    1.2760   -0.1580 ca        1 MOL     -0.180915
      8 H4         -0.1210    2.3480   -0.2150 ha        1 MOL      0.120993
      9 C4         -1.2630    0.5510   -0.1970 ca        1 MOL      0.157206
     10 S1         -2.8330    1.3820   -0.3880 sh        1 MOL     -0.306690
     11 H5         -3.1360    1.5470    0.8960 hs        1 MOL      0.154485
     12 C5         -1.1910   -0.8320   -0.1410 ca        1 MOL     -0.101430
     13 H6         -2.0930   -1.4150   -0.1850 ha        1 MOL      0.119336
     14 C6          0.0300   -1.4710   -0.0390 ca        1 MOL     -0.379298
     15 H7          0.0680   -2.5460   -0.0010 ha        1 MOL      0.196514
     16 C7          1.2150   -0.7420    0.0100 ca        1 MOL      0.433842
     17 N1          2.4400   -1.3810    0.1590 nh        1 MOL     -0.946080
     18 H8          3.1850   -0.9370   -0.3330 hn        1 MOL      0.393930
     19 H9          2.4130   -2.3620   -0.0210 hn        1 MOL      0.393930

      1 C1          0.8450   -0.4030   -0.1980 ca        1 MOL     -0.178577
      2 C2          1.9750   -1.3720   -0.4250 c3        1 MOL      0.334818
      3 H1          1.5770   -2.3780   -0.5140 h1        1 MOL     -0.003114
      4 O1          2.8910   -1.3020    0.6480 oh        1 MOL     -0.661250
      5 H2          3.6190   -1.8840    0.4770 ho        1 MOL      0.411407
      6 H3          2.4830   -1.1300   -1.3560 h1        1 MOL     -0.003114
      7 C3         -0.4610   -0.8520   -0.1310 ca        1 MOL     -0.111843
      8 H4         -0.6550   -1.9080   -0.1960 ha        1 MOL      0.110821
      9 C4         -1.5340    0.0210    0.0110 ca        1 MOL      0.074323
     10 S1         -3.2040   -0.6010    0.1340 sh        1 MOL     -0.300720
     11 H5         -3.5300   -0.5740   -1.1540 hs        1 MOL      0.163606
     12 C5         -1.2700    1.3780    0.1110 ca        1 MOL     -0.043801
     13 H6         -2.0810    2.0710    0.2370 ha        1 MOL      0.112099
     14 C6          0.0290    1.8480    0.0610 ca        1 MOL     -0.423226
     15 H7          0.2170    2.9040    0.1440 ha        1 MOL      0.201747
     16 C7          1.1000    0.9730   -0.0910 ca        1 MOL      0.482003
     17 N1          2.4020    1.4480   -0.1890 nh        1 MOL     -0.955682
     18 H8          3.0790    0.8510    0.2360 hn        1 MOL      0.395252
     19 H9          2.5130    2.3950    0.1020 hn        1 MOL      0.395252

      1 C1          1.1550    0.6580   -0.0420 ca        1 MOL     -0.130494
      2 C2          2.4130    1.4790    0.0710 c3        1 MOL      0.332882
      3 H1          2.1600    2.5340    0.0440 h1        1 MOL     -0.003588
      4 O1          3.2910    1.1600   -0.9890 oh        1 MOL     -0.662949
      5 H2          4.0950    1.6510   -0.8870 ho        1 MOL      0.411785
      6 H3          2.8990    1.2760    1.0220 h1        1 MOL     -0.003588
      7 C3         -0.0770    1.2760   -0.1580 ca        1 MOL     -0.180700
      8 H4         -0.1210    2.3480   -0.2150 ha        1 MOL      0.120902
      9 C4         -1.2630    0.5510   -0.1970 ca        1 MOL      0.157062
     10 S1         -2.8330    1.3830   -0.3870 sh        1 MOL     -0.306643
     11 H5         -3.1360    1.5470    0.8960 hs        1 MOL      0.154428
     12 C5         -1.1920   -0.8320   -0.1410 ca        1 MOL     -0.101181
     13 H6         -2.0930   -1.4150   -0.1860 ha        1 MOL      0.119296
     14 C6          0.0300   -1.4710   -0.0400 ca        1 MOL     -0.379635
     15 H7          0.0680   -2.5460   -0.0020 ha        1 MOL      0.196603
     16 C7          1.2150   -0.7420    0.0090 ca        1 MOL      0.434009
     17 N1          2.4390   -1.3820    0.1590 nh        1 MOL     -0.946042
     18 H8          3.1850   -0.9370   -0.3330 hn        1 MOL      0.393926
     19 H9          2.4130   -2.3620   -0.0220 hn        1 MOL      0.393926

      1 C1         -0.8450   -0.4030    0.1980 ca        1 MOL     -0.000094
      2 C2         -1.9750   -1.3730    0.4250 c3        1 MOL     -0.344126
      3 H1         -1.5770   -2.3780    0.5140 h1        1 MOL      0.211843
      4 O1         -2.8910   -1.3020   -0.6480 oh        1 MOL     -0.567602
      5 H2         -3.6190   -1.8850   -0.4760 ho        1 MOL      0.411686
      6 H3         -2.4830   -1.1310    1.3560 h1        1 MOL      0.211843
      7 C3          0.4610   -0.8520    0.1310 ca        1 MOL      0.086938
      8 H4          0.6550   -1.9080    0.1950 ha        1 MOL      0.010714
      9 C4          1.5340    0.0210   -0.0110 ca        1 MOL     -0.282636
     10 S1          3.2040   -0.6010   -0.1340 sh        1 MOL     -0.179106
     11 H5          3.5290   -0.5730    1.1550 hs        1 MOL      0.157669
     12 C5          1.2700    1.3780   -0.1110 ca        1 MOL      0.243484
     13 H6          2.0810    2.0710   -0.2370 ha        1 MOL      0.025461
     14 C6         -0.0290    1.8480   -0.0610 ca        1 MOL     -0.544482
     15 H7         -0.2170    2.9040   -0.1440 ha        1 MOL      0.215609
     16 C7         -1.1000    0.9730    0.0910 ca        1 MOL      0.490765
     17 N1         -2.4020    1.4480    0.1890 nh        1 MOL     -0.967096
     18 H8         -3.0790    0.8510   -0.2360 hn        1 MOL      0.409565
     19 H9         -2.5130    2.3950   -0.1020 hn        1 MOL      0.409565
~~~

由此可见:

1. D0.1和B0.2的坐标结果基本一致, 电势结果也基本一致,偏差较小.
2. 使用nosymm和不适用nosymm结果有差异, 建议使用同一套方法处理即可. 要是使用B01,建议加入nosymm(加入后的值更准).
3. 由原子14起, fix工具使用`%i`和`%s`处理就开始出现较大偏差(约0.5,可能由于末尾`****`没加入fit所以不能正常被解析,导致最后一些坐标电荷缺失,从而影响结果.因此fix工具中使用`%s`将更好.这个问题可能作者都没有注意到..用fix工具出来的resp实际是优化后结构的,和正常途径获得的结果略有差异,但不大,主要可能是正常路径用于计算的charge center大概是6000多,而fix工具出来的约是12000左右,点更密集的缘故吧. Anyway, 还是推荐使用正常方法出来的结果.

## Reference

1. [ANU-非标准残基设置和计算教程](http://sf.anu.edu.au/collaborations/amber_on_fujitsu/amber-12/tutorial/nonstandard-setup/index.html)
2. [How to run a RESP calculation](http://www.teokem.lu.se/~ulf/Methods/resp.html)
3. [Gaussian IOP](http://www.gaussian.com/g_tech/g_iops/iops2.pdf)

------
